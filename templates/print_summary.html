{% extends "base.html" %}

{% block title %}Versión para imprimir · Sistema de gestión de tarjetas{% endblock %}

{% block extra_head %}
<style>
  /* Página horizontal para impresión */
  @page {
    size: A4 landscape;
    margin: 1.5cm;
  }

  @media print {
    body {
      -webkit-print-color-adjust: exact;
    }
    .main-navbar,
    .footer,
    .btn,
    .no-print {
      display: none !important;
    }
    .content-container {
      box-shadow: none;
      margin: 0;
      padding: 0;
    }
  }

  .print-wrapper {
    margin-top: 1rem;
  }

  .print-page {
    page-break-after: always;
    padding: 0.5rem 0;
  }
  .print-page:last-of-type {
    page-break-after: auto;
  }

  .print-title {
    text-align: center;
    font-size: 1.3rem;
    font-weight: 600;
    margin-bottom: 0.25rem;
  }

  .print-subtitle {
    text-align: center;
    font-size: 0.95rem;
    color: #555;
    margin-bottom: 0.75rem;
  }

  .print-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.8rem;
  }
  .print-table th,
  .print-table td {
    border: 1px solid #ccc;
    padding: 0.25rem 0.35rem;
  }
  .print-table thead th {
    background-color: #f0f2f5;
  }

  .signature-row {
    margin-top: 2.5rem;
    display: flex;
    justify-content: space-around;
  }
  .signature-box {
    width: 40%;
    text-align: center;
    padding-top: 2.5rem;
  }
  .signature-line {
    border-top: 1px solid #000;
    margin-bottom: .25rem;
  }
  .signature-role {
    font-size: 0.85rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="content-container print-wrapper">

  {# 1) Páginas de detalle por categoría (en orden) #}
  {% for code in ["MODULO", "MAESTRA", "MANTENCION", "PROVISORIA"] %}
    {% set rows = category_rows.get(code, []) %}
    <section class="print-page">
      <div class="print-title">
        Detalle de tarjetas — {{ category_labels.get(code, code) }}
      </div>
      <div class="print-subtitle">
        Estado actual de las tarjetas registradas
      </div>

      <table class="print-table">
        <thead>
          <tr>
            {% for field_name, label in category_definitions[code] %}
              <th>{{ label }}</th>
            {% endfor %}
            <th>Activa / Inactiva</th>
            <th>Estado actual</th>
          </tr>
        </thead>
        <tbody>
          {% if rows %}
            {% for r in rows %}
              <tr>
                {% for v in r.values_list %}
                  <td>{{ v }}</td>
                {% endfor %}
                <td>{{ r.status }}</td>
                <td>{{ r.estado_texto }}</td>
              </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="{{ category_definitions[code]|length + 2 }}"
                  class="text-center">
                Sin tarjetas registradas en esta categoría.
              </td>
            </tr>
          {% endif %}
        </tbody>
      </table>
    </section>
  {% endfor %}

  {# 2) Última página: resumen general + firmas #}
  <section class="print-page">
    <div class="print-title">
      Resumen general de tarjetas
    </div>
    <div class="print-subtitle">
      Totales por categoría
    </div>

    <table class="print-table">
      <thead>
        <tr>
          <th>Categoría</th>
          <th>Total</th>
          <th>Activas</th>
          <th>Inactivas</th>
          <th>Pendientes de devolución</th>
        </tr>
      </thead>
      <tbody>
        {% if summary_rows %}
          {% for row in summary_rows %}
            <tr>
              <td>{{ category_labels.get(row.category, row.category) }}</td>
              <td>{{ row.total }}</td>
              <td>{{ row.activas }}</td>
              <td>{{ row.inactivas }}</td>
              <td>{{ row.pendientes }}</td>
            </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="5" class="text-center">
              No hay información disponible.
            </td>
          </tr>
        {% endif %}
      </tbody>
    </table>

    <div class="signature-row">
      <div class="signature-box">
        <div class="signature-line"></div>
        <div class="signature-role">Administradora hotelera</div>
      </div>
      <div class="signature-box">
        <div class="signature-line"></div>
        <div class="signature-role">Supervisor hotelero</div>
      </div>
    </div>
  </section>
</div>
{% endblock %}
